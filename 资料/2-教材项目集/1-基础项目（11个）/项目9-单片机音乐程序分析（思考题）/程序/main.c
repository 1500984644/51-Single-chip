//单片机音乐程序分析，针对B105型实验开发板设计
//通过蜂鸣器播放出简单的音乐
//设计：单片机创新工作室--冷恩鑫设计，2015年12月15日
#include <reg52.h>
sbit fmq=P3^7;
unsigned char i,x,y,k,keys,a;
unsigned char code pinlv[]={131,110,98, 87, 73, 87, 110,98, 131,0,110,98, 87, 73, 73,  
							65, 98,87,87,87,73,65,73,65,55,58,65,73,65,87,110,98,87,
							73,110,131,110,98,87,65,73,73,0,87,65,65,73,82,87,98,87,
							73,131,110,98,0,110,98,87,73,65,55,58,65,73,87,65,65,				
							44,37,33,33,37,33,44,49,44,37,33,33,37,33,44, 				// 康定情歌
							44,37,33,33,37,33,44,49,37,44,49,44,49,55,49, 
							65,37,44,49,55,33,37,44,49,44,49,55,49,65,				
							74,74,65,74,55,58,74,74,65,74,49,55,74,74,37,				//生日快乐
							44,55,58,66,41,41,44,55,49,55};    
unsigned int code jiepai[]={110,131,147,494,196,165,131,294,440,1,131,147,
					165,588,196,440,294,660,330,165,196,880,588,220,
					262,124,110,196,220,330,131,147,495,196,262,220,
					131,147,165,220,784,392,2,660,660,220,196,175,330,
					588,495,196,110,131,147,2,131,147,330,392,440,524,
					247,220,196,165,880,880,					
					330,392,440,880,784,440,698,586,330,392,440,  
					880,392,440,660,330,392,440,880,392,440,330,
					586,392,330,586,660,586,524,392,586,392,1320,
					586,524,1960,392,330,586,660,586,524,293,880,					
					146,292,440,392,524,984,146,292,440,392,586,
					1048,392,146,784,660,524,492,440,1466,349,660,524,586,1048};		//让我们荡起双桨、68											
void delay(unsigned int m)
{
    unsigned char j;
	while(m--)
	{
		for(j=0;j<115;j++);
	}
}
void yanzou(unsigned char pinlv,unsigned int jiepai)
{
	unsigned char pl;
	unsigned int jp;
	if(jiepai==1) delay(250);															//1/2拍暂停，即1/2拍的0
	else if(jiepai==2) delay(500);														//1拍暂停，即1拍的0
	else
    { 
		for(jp=0;jp<jiepai;jp++)
		{
		     fmq=0;
			 for(pl=0;pl<pinlv;pl++);
			 fmq=1;
			 for(pl=0;pl<pinlv;pl++);
		}
	}	
}  
void timer0_init(void)
{
	TMOD = 0x01;
	TH0 = (65536 - 2000) / 256;
	TL0 = (65536 - 2000) % 256;
	EA = 1;
	ET0 = 1;
	TR0 = 1;
}
void timer0_isr(void)interrupt 1
{
	TH0 = (65536 - 2000) / 256;
	TL0 = (65536 - 2000) % 256;
}
void main()
{
	timer0_init();
	while(1)
	{	
	 	yanzou(pinlv[x],jiepai[x]);
		x++; 
		if(x > 138) x = 0;
	}		
}